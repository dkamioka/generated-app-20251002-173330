# Google OAuth Setup Guide

This guide will help you set up Google OAuth for both development and production environments.

## Step 1: Create Google OAuth Credentials

### 1.1 Go to Google Cloud Console
Visit: https://console.cloud.google.com/apis/credentials

### 1.2 Create OAuth Client ID (or use existing)

1. Click **"Create Credentials"** → **"OAuth client ID"**
2. Choose **"Web application"**
3. Give it a name (e.g., "Kido Go Game - Production")

### 1.3 Configure Authorized JavaScript Origins

Add your domain(s) to **"Authorized JavaScript origins"**:

**For Production:**
```
https://v1-kido-go-game-90976a1a-44ff-4a66-aa8b-a67ff329f54a.farofitus.workers.dev
```

**For Local Development:**
```
http://localhost:5173
http://localhost:4173
http://127.0.0.1:5173
http://127.0.0.1:4173
```

### 1.4 Authorized Redirect URIs

**IMPORTANT:** For `@react-oauth/google` library, you **DO NOT** need to add redirect URIs!

The library uses Google Identity Services (One Tap/Popup flow) which only requires JavaScript origins, not redirect URIs.

### 1.5 Save and Copy Client ID

Click **Save** and copy your **Client ID** (looks like: `xxxxx.apps.googleusercontent.com`)

---

## Step 2: Configure Local Development

### 2.1 Create .env.local file

In your project root, create `.env.local`:

```bash
# Copy from .env.example
cp .env.example .env.local
```

### 2.2 Add your Client ID

Edit `.env.local` and add your Google Client ID:

```env
VITE_GOOGLE_CLIENT_ID=your-actual-client-id.apps.googleusercontent.com
```

### 2.3 Restart Dev Server

```bash
bun run dev
```

---

## Step 3: Configure Production

### 3.1 Set Environment Variable for Build

When deploying to production, set the environment variable before building:

```bash
# Option A: Set in your CI/CD environment
export VITE_GOOGLE_CLIENT_ID=your-production-client-id.apps.googleusercontent.com
npm run build
npx wrangler deploy

# Option B: Inline with deploy command
VITE_GOOGLE_CLIENT_ID=your-client-id.apps.googleusercontent.com npm run build && npx wrangler deploy
```

### 3.2 OR: Hardcode in wrangler.toml (Not Recommended)

You can also set it in `wrangler.jsonc` under `vars`, but this exposes the Client ID in your repo (which is generally OK for Client IDs since they're public anyway):

```json
{
  "vars": {
    "VITE_GOOGLE_CLIENT_ID": "your-client-id.apps.googleusercontent.com"
  }
}
```

**Note:** Client IDs are considered public and are safe to commit. Client Secrets should NEVER be committed.

---

## Troubleshooting

### 404 Error from Google

**Problem:** Clicking "Sign in with Google" shows Google 404 error

**Solution:**
1. Check that your **Client ID** exists in Google Cloud Console
2. Verify the **Authorized JavaScript origins** include your exact domain
3. Make sure the Client ID doesn't have any typos
4. Wait 5-10 minutes after making changes (Google caches configuration)
5. Clear browser cache and try again

### "VITE_GOOGLE_CLIENT_ID is not configured" Warning

**Problem:** Console shows warning about missing Client ID

**Solution:**
1. Create `.env.local` file with `VITE_GOOGLE_CLIENT_ID`
2. Restart your dev server (`bun run dev`)
3. For production, set the env var before building

### OAuth Still Not Working

**Checklist:**
- ✅ Client ID is correct in `.env.local`
- ✅ Authorized JavaScript origins include your exact domain (no trailing slash)
- ✅ OAuth consent screen is configured in Google Cloud Console
- ✅ Dev server was restarted after creating `.env.local`
- ✅ Browser cache was cleared
- ✅ Using HTTPS in production (HTTP only for localhost)

### Different Client IDs for Dev vs Production

It's recommended to create **separate OAuth clients** for development and production:

1. **Dev Client:** `dev-client-id.apps.googleusercontent.com`
   - Origins: `http://localhost:5173`, `http://127.0.0.1:5173`

2. **Prod Client:** `prod-client-id.apps.googleusercontent.com`
   - Origins: `https://your-production-domain.workers.dev`

Then use `.env.local` for dev and build-time env var for production.

---

## Security Notes

- ✅ **Client IDs are public** - Safe to commit to git
- ❌ **Client Secrets are private** - NEVER commit these (backend only, use wrangler secrets)
- ✅ **Authorized origins** protect against unauthorized domains using your OAuth
- ✅ **JWT tokens** are generated by your backend and should use strong secrets

---

## Current Configuration

**Production URL:** https://v1-kido-go-game-90976a1a-44ff-4a66-aa8b-a67ff329f54a.farofitus.workers.dev

**Current Client ID (fallback):** 102189159129-v8v7g16h30j5vvev5q5i06o6qj5v11j9.apps.googleusercontent.com

**Recommendation:** Create your own OAuth client for production with your production URL in the authorized origins.
